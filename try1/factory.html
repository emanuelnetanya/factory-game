<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>×—×“×¨ ×‘×¨×™×—×” â€“ ×¡×™×•×¨ ×‘××¤×¢×œ ×ª×¢×©×™×™×ª×™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- BabylonJS -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: "Heebo", Arial, sans-serif;
      background: radial-gradient(circle at 20% 0%, #ffffff 0%, #e3f2fd 35%, #bbdefb 100%);
    }

    #renderCanvas {
      width: 100%;
      height: 100%;
      display: block;
      touch-action: none;
      outline: none;
    }

    /* ===== HUD ×¤×©×•×˜ ×œ××¢×œ×” ===== */
    .hud-top {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 50;
      pointer-events: none;
    }

    .hud-top > * {
      pointer-events: auto;
    }

    .hud-badge {
      background: rgba(255,255,255,0.9);
      border-radius: 999px;
      padding: 8px 14px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hud-btn {
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(102,126,234,0.45);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .hud-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 22px rgba(102,126,234,0.55);
    }

    /* ====== ××•×‘×¨×œ×™×™ ×œ××™× ×™-××©×—×§ ×”×”×•× ×’×¨×™ ====== */
    .hungarian-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 10px;
    }

    .hungarian-frame {
      width: 100%;
      height: 100%;
      max-width: 480px;
      max-height: 900px;
      background: #000;
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 25px 60px rgba(0,0,0,0.6);
      position: relative;
    }

    .hungarian-frame iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .hungarian-close-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ×˜×§×¡×˜ ×”×“×¨×›×” ×œ××˜×” */
    .bottom-hint {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 500;
      box-shadow: 0 -2px 16px rgba(0,0,0,0.15);
      z-index: 40;
    }
  </style>
</head>
<body>
  <!-- Canvas ×©×œ ×‘××‘×™×œ×•×Ÿ -->
  <canvas id="renderCanvas"></canvas>

  <!-- HUD ×œ××¢×œ×” -->
  <div class="hud-top">
    <div class="hud-badge">
      ğŸ­ ×—×“×¨ ×‘×¨×™×—×” â€“ ×ª×—× ×” <span id="station-label">1/2</span>
    </div>
    <button class="hud-btn" onclick="startRoute()">
      â–¶ï¸ ×”×ª×—×œ ××¡×œ×•×œ
    </button>
  </div>

  <div class="bottom-hint" id="bottom-hint">
    ×”×–×– ××ª ×”××¦×œ××” ×¢× ×”××¦×‘×¢ / ×¢×›×‘×¨. ×›×©×ª×’×™×¢ ×œ×ª×—× ×ª ×”×©×œ×™×—×™× â€“ ×™×¤×ª×— ××©×—×§ ×”×”×§×¦××”.
  </div>

  <!-- ===== ××•×‘×¨×œ×™×™ ×¢× ×”××©×—×§ ×”×”×•× ×’×¨×™ ×‘×ª×•×š iframe ===== -->
  <div id="hungarian-overlay" class="hungarian-overlay">
    <div class="hungarian-frame">
      <button class="hungarian-close-btn" onclick="closeHungarianGame()">âœ•</button>
      <!-- ×—×©×•×‘: ×œ×©× ×•×ª ×œ×›×ª×•×‘×ª ×©×œ ×”×§×•×‘×¥ ×©×œ×š -->
      <iframe id="hungarian-iframe" src="HungarianDeliveryGame.html"></iframe>
    </div>
  </div>

  <script>
    let canvas, engine, scene, camera;
    let player;
    let station1, station2;
    let currentStationIndex = 0;
    let isMoving = false;
    let gamePaused = false;

    // ===== ×™×¦×™×¨×ª ×¡×¦× ×” ×‘×¡×™×¡×™×ª =====
    function createScene() {
      canvas = document.getElementById("renderCanvas");
      engine = new BABYLON.Engine(canvas, true, { antialias: true });
      scene = new BABYLON.Scene(engine);
      scene.clearColor = new BABYLON.Color4(0.92, 0.96, 1, 1);

      const isMobile = window.innerWidth < 768;

      camera = new BABYLON.ArcRotateCamera(
        "camera",
        -Math.PI / 2,
        isMobile ? Math.PI / 3 : Math.PI / 2.8,
        isMobile ? 55 : 50,
        BABYLON.Vector3.Zero(),
        scene
      );
      camera.attachControl(canvas, true);
      camera.lowerRadiusLimit = 30;
      camera.upperRadiusLimit = 80;

      const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
      light.intensity = 0.9;

      const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 120, height: 120 }, scene);
      const groundMat = new BABYLON.StandardMaterial("groundMat", scene);
      groundMat.diffuseColor = new BABYLON.Color3(0.9, 0.93, 0.96);
      ground.material = groundMat;

      // ===== "×©×‘×™×œ" ×¤×©×•×˜ =====
      const pathMat = new BABYLON.StandardMaterial("pathMat", scene);
      pathMat.diffuseColor = new BABYLON.Color3(0.8, 0.84, 0.9);

      const path = BABYLON.MeshBuilder.CreateBox("path", { width: 12, height: 0.1, depth: 80 }, scene);
      path.position.y = 0.05;
      path.material = pathMat;

      // ===== ×”×©×—×§×Ÿ =====
      player = BABYLON.MeshBuilder.CreateSphere("player", { diameter: 4 }, scene);
      player.position = new BABYLON.Vector3(0, 2, 30);
      const playerMat = new BABYLON.StandardMaterial("playerMat", scene);
      playerMat.diffuseColor = new BABYLON.Color3(0.2, 0.5, 0.9);
      player.material = playerMat;

      // ===== ×ª×—× ×” 1 â€“ ××©×™××” ×¨×’×™×œ×” =====
      station1 = BABYLON.MeshBuilder.CreateBox("station1", { width: 8, height: 2, depth: 4 }, scene);
      station1.position = new BABYLON.Vector3(0, 1, 10);
      const station1Mat = new BABYLON.StandardMaterial("station1Mat", scene);
      station1Mat.diffuseColor = new BABYLON.Color3(0.3, 0.8, 0.5);
      station1.material = station1Mat;

      // ===== ×ª×—× ×” 2 â€“ ××©×—×§ ×”×”×§×¦××” (×”×•× ×’×¨×™) =====
      station2 = BABYLON.MeshBuilder.CreateBox("station2", { width: 8, height: 2, depth: 4 }, scene);
      station2.position = new BABYLON.Vector3(0, 1, -10);
      const station2Mat = new BABYLON.StandardMaterial("station2Mat", scene);
      station2Mat.diffuseColor = new BABYLON.Color3(0.9, 0.6, 0.2);
      station2.material = station2Mat;

      const gui = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

      function makeStationLabel(mesh, text, color) {
        const rect = new BABYLON.GUI.Rectangle();
        rect.width = "120px";
        rect.height = "32px";
        rect.cornerRadius = 16;
        rect.color = "#ffffff";
        rect.thickness = 2;
        rect.background = color;
        gui.addControl(rect);
        rect.linkWithMesh(mesh);
        rect.linkOffsetY = -50;

        const tb = new BABYLON.GUI.TextBlock();
        tb.text = text;
        tb.color = "white";
        tb.fontFamily = "Heebo";
        tb.fontSize = 14;
        tb.fontWeight = "bold";
        rect.addControl(tb);
      }

      makeStationLabel(station1, "×ª×—× ×” 1 â€“ ××©×™××” A", "#4CAF50");
      makeStationLabel(station2, "×ª×—× ×” 2 â€“ ××©×—×§ ×”×§×¦××ª ×©×œ×™×—×™×", "#FF9800");

      return scene;
    }

    // ===== ××¡×œ×•×œ ×‘×¡×™×¡×™: ×”×©×—×§×Ÿ ×”×•×œ×š ×œ×ª×—× ×” 1 ×•××– ×œ×ª×—× ×” 2 =====
    function startRoute() {
      if (isMoving || gamePaused) return;
      currentStationIndex = 0;
      moveToNextStation();
    }

    function moveToNextStation() {
      if (gamePaused) return;

      const stations = [station1, station2];
      if (currentStationIndex >= stations.length) {
        document.getElementById("bottom-hint").textContent = "×¡×™×™××ª ××ª ×”××¡×œ×•×œ! ğŸ“";
        return;
      }

      const target = stations[currentStationIndex];
      const dist = BABYLON.Vector3.Distance(player.position, target.position);

      isMoving = true;
      gsap.to(player.position, {
        x: target.position.x,
        z: target.position.z,
        duration: dist / 15,
        ease: "power2.inOut",
        onComplete: () => {
          isMoving = false;
          onArriveStation(currentStationIndex);
        }
      });

      const label = document.getElementById("station-label");
      label.textContent = (currentStationIndex + 1) + "/2";
    }

    // ===== ××” ×§×•×¨×” ×›×©××’×™×¢×™× ×œ×ª×—× ×” =====
    function onArriveStation(index) {
      if (index === 0) {
        // ×ª×—× ×” 1 â€“ ××¤×©×¨ ×œ×©×™× ×˜×§×¡×˜ / ×©××œ×” / ×§×•×•×™×–
        document.getElementById("bottom-hint").textContent =
          "×”×’×¢×ª ×œ×ª×—× ×” 1. (×›××Ÿ ××¤×©×¨ ×œ×©×™× ×—×™×“×”). ×¢×•×‘×¨×™× ×œ×ª×—× ×” 2 â€“ ××©×—×§ ×”×”×§×¦××”...";
        currentStationIndex++;
        setTimeout(moveToNextStation, 1500);
      } else if (index === 1) {
        // ×ª×—× ×” 2 â€“ ×›××Ÿ × ×¤×ª×— ××©×—×§ ×”×”×•× ×’×¨×™!
        document.getElementById("bottom-hint").textContent =
          "×”×’×¢×ª ×œ×ª×—× ×ª ×”×§×¦××ª ×”×©×œ×™×—×™×. ×”××©×—×§ ×¢×•××“ ×œ×”×™×¤×ª×—...";
        openHungarianGame();
      }
    }

    // ====== ××•×‘×¨×œ×™×™ â€“ ××©×—×§ ×”×”×•× ×’×¨×™ ×‘×ª×•×š iframe ======
    function openHungarianGame() {
      const overlay = document.getElementById("hungarian-overlay");
      overlay.style.display = "flex";
      gamePaused = true;
    }

    function closeHungarianGame() {
      const overlay = document.getElementById("hungarian-overlay");
      overlay.style.display = "none";
      gamePaused = false;
      // ×× ×¨×•×¦×™× â€“ ×œ× ×××©×™×›×™× ×œ××¡×œ×•×œ ××›××Ÿ, ×¨×§ ×¡×’×™×¨×” ×™×“× ×™×ª
    }

    // *** ×¤×•× ×§×¦×™×” ×©×”××™× ×™-××©×—×§ ×™×§×¨× ×œ×”: ×”××©×š ×œ×ª×—× ×” ×”×‘××” ***
    function onHungarianGameComplete() {
      const overlay = document.getElementById("hungarian-overlay");
      overlay.style.display = "none";
      gamePaused = false;

      document.getElementById("bottom-hint").textContent =
        "×¡×™×™××ª ××ª ××©×—×§ ×”×§×¦××ª ×”×©×œ×™×—×™×! ×××©×™×›×™× ×œ×ª×—× ×” ×”×‘××” / ×¡×™×•× ×”××¡×œ×•×œ ğŸ‰";

      currentStationIndex++;   // ×× × ×¨×¦×” ×œ×”××©×™×š ×œ×ª×—× ×” 3 ×‘×¢×ª×™×“
      // ×›××Ÿ ××¤×©×¨ ×œ×§×¨×•× ×œ×¤×•× ×§×¦×™×” ×©×××©×™×›×” ×‘××¡×œ×•×œ ×”×××™×ª×™ ×©×œ×š:
      // moveToNextStation();
    }

    // ===== ×”×¨×¦×” =====
    createScene();
    engine.runRenderLoop(() => scene.render());
    window.addEventListener("resize", () => engine.resize());
  </script>
</body>
</html>
